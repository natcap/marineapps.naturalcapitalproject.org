<html>
<head>
<title>Smart Coasts</title>
<head>
  <meta charset="utf-8" />
  <html lang="en">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <!--jQuery-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  
  <!--CartoDB-->
  <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
  <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.uncompressed.js"></script>
  
  <!-- Leaflet Plugins -->
  <link rel="stylesheet" href="src/Control.MiniMap.css" />
  <script src="src/Control.MiniMap.js" type="text/javascript"></script> 
   <link rel="stylesheet" href="css/leaflet.draw.css"/>
  <script src="js/leaflet.draw.js"></script>
  
  <!--Fonts-->
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href="http://fonts.googleapis.com/css?family=Lato:300italic,400italic,600italic,700italic,400,300,600,700" rel="stylesheet" type="text/css">
  
  <!--Google-->  
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  
</head>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

</script>  
  
<style type="text/css">
body{
font: 100% "Noto Serif", sans-serif;
margin: 0;
padding: 0px;
border: 0;
height: 100%;  0
max-height: 100%; 
}

html, body, #map {
    height: 100%;
    padding: 0;
    margin: 0;
}


img {
    max-width: 100%;
    max-height: auto;
	margin-left:0%; margin-right:0%;
}

br {
	line-height: 100%;
}

h5 {
	line-height: 100%;
}

input[type="text"] {
    width: 206px;
}

input[type="radio"]{
 vertical-align: top;
}


#table03a { width:100%; border:0px solid #D9D5BE; margin:0px; background:#fff; border-collapse:collapse;}
#table03a td { border:0px solid #D9D5BE; vertical-align: middle; width: 300px; padding: 0px;}


.cartodb-popup v2 p {z-index:9999;}

.map-legend{
	   border-radius: 5px;
	   position: relative;
	   bottom: 185px;
	   right: 0px;
	   padding-left: 20px;
	   padding-right: 0px;
	   padding-top: 7px;
	   padding-bottom: 7px;
	   border:1px solid #000;
	   background-color: #fff; 
	   min-width: 240px;
	   max-width: 240px;
	   min-height: 100px;
}

.bottom{
	   border-radius: 5px;
	   position: absolute;
	   bottom: 0px;
	   left: 0px;
	   padding-left: 20px;
	   padding-right: 0px;
	   padding-bottom: 30px;
	   border:1px solid #000;
	   background-color: #D4D4D4;
	   color: #000;
	   min-width: 240px;
}
  
.key{
	   border-radius: 5px;
	   position: absolute;
	   bottom: 281px;
	   left: 0px;
	   padding-bottom: 10px;
	   padding-top: 10px;
	   padding-left: 20px;
	   padding-right: 0px;
	   border:1px solid #000;
	   background-color: #fff;
	   color: #000;
	   min-width: 240px;
}
  
  
/* gives the tooltip a margin from the pointer */
  
  body > div.cartodb-tooltip{
	margin-top: 10px !important;
	margin-left: 10px !important;
	border-radius: 15px;
	z-index:1;
  }
  /* gives to the tooltip different styles */
  div.cartodb-tooltip-content-wrapper{
  font: 100% "Noto Serif", sans-serif;
	padding: 5px 5px 5px 5px;
	max-width: 200px;
	text-align: center;
	background-color: #fff!important;
	opacity: 0.9;
	border-radius: 35px!important;
	border:1px solid #000;
	z-index:9999;
  }
  /* set styles to the <p> tag of the tooltip */
   div.cartodb-tooltip-content-wrapper p{
	color: black!important;
  }
  /* set infobox styles */
 .cartodb-infobox{
	opacity:0.75;
	background-color: #fff!important;
	color: #fff!important;
	border-radius: 50px!important;
  }
 /* set styles to the div element with id= box */
 /* #box{
	position: absolute;
	top: 20px;
	left: 20px;
	width: 200px;
	height: 170px;
	opacity: 0.9;
	padding: 25px 25px 25px 25px;
	border-radius: 15px;
	background-color: #FFF;
	color: #fdb462;

  }*/
  /* set styles to the <h4> tag of the element with id= box */
  #box h4{
	font-style: italic;
  }
  /* set styles to the <p> tag of the element with id= box */
  #box p{
	text-align: center;
	font-size: 18px;
	color:red;

  }
  /* set styles to the custom infowindow */
  .infowindow-custom{ 
	position: relative;
	width: 500px;
	background-color: #FFF;
	margin-bottom: 2px;
	opacity: 0.9;
	text-align: left;
	font-style: oblique;
	background-color: #FFF;
	color: #fdb462;
	border-radius: 10px;
  }
  
  .cartodb-popup-content .content h3{
	  font-style: italic;
  }
  .cartodb-popup-content .content p{
	  text-align: left;
	  font-size: 16px;
	  color:red;
	  margin-left: 20px;
  }
   
  /* set styles to the custom infowindow -> close button */
  .cartodb-popup-close-button {
	position: absolute;
	top: -12px;
	right: -11px;
	width: 26px;
	height: 26px;
	background: url('http://libs.cartodb.com/cartodb.js/v3/themes/img/light.png') no-repeat 0 -23px;
	text-indent: -9999px;
	font-size: 0;
	line-height: 0;
	opacity: 1;
	text-transform: uppercase;
	z-index: 3;
  }
  /* set styles to the custom infowindow -> tip container */
  .cartodb-popup-tip-container{
	position: absolute;
	bottom: -13px;
	left: 23px;
	 width: 16px;
	 height: 14px;
	 background: url('http://libs.cartodb.com/cartodb.js/v3/themes/img/light.png') no-repeat -23px -7px;
	 text-indent: -9999px;
	 font-size: 0;
	 line-height: 0;
	 opacity: 1;
	 z-index: 3;
  }
  /* change legend's position and style */
  .cartodb-legend{
	 left: 20px;
	 bottom: 50px!important;
	 width: 90px;
	 height: auto;
	 background-color: #FFF;
	 opacity: 1;
	 border-radius: 25px!important;
   } 
   .cartodb-legend ul li{
	margin-left: 5px!important;
	font-style: italic!important;
	font-size: 10px!important;

   }
  


</style>

<body>


<div id="map"></div>


<script>

$( document ).ready(function() {
  
	$( "#zoomFly").val(2);
	var e = document.getElementById("zoomFly");
	var ddSitesVal = e.options[e.selectedIndex].value;
	showSites(ddSitesVal);
	addLegend($( "#zoomFly option:selected" ).text());

});

// define basemaps
var ESRIImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri'});

var CartoLight = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
		  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
		});

var ESRIOcean = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}.png', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, GEBCO, NOAA, and DeLorme'});


// set base map and controls
var map = new L.Map('map', {
  zoomControl: false,
  layer_selector: false,
  layers: [CartoLight],
  center: [17, -88],
  zoom: 8,
  minZoom: 5,
  maxZoom: 10
});

// MAR: 18, -88 >> 7
// Mexico: 21.15, -87.25 >> 9
// Belize: 17, -88 >> 8
// Guatemala: 15.25, -88.3 >> 8
// Honduras: 15.5, -86 >> 8

var southWest = L.latLng(0, -110),
northEast = L.latLng(30, -60);
var bounds = L.latLngBounds(southWest, northEast);

map.setMaxBounds(bounds);
map.on('drag', function() {
    map.panInsideBounds(bounds, { animate: false });
});



// add CartoDB vector
var cntry_mpa = 'https://stanford.carto.com/u/gverutes/api/v2/viz/7bd2c014-c1ca-434a-a313-bacce5adc800/viz.json';
var land_grid = 'https://stanford.carto.com/u/gverutes/api/v2/viz/0a053efe-8e4c-42c5-9c66-9ab7473d58b0/viz.json'; // extreme heat days
var land_grid2 = 'https://stanford.carto.com/u/gverutes/api/v2/viz/d46896f6-f0f7-4148-a85a-8a8de2780152/viz.json'; // rainy days 
var land_grid3 = 'https://stanford.carto.com/u/gverutes/api/v2/viz/26b39dfa-d876-484d-8381-294271efaf38/viz.json'; // precip
var land_grid4 = 'https://stanford.carto.com/u/gverutes/api/v2/viz/b1655c2d-2357-44b0-b1b2-675213b4ead7/viz.json'; // temp


// drop-downs on map
var legend = L.control({position: 'bottomleft'});

legend.onAdd = function (map) {
  	var div = L.DomUtil.create('div', 'info legend');
	div.innerHTML = div.innerHTML + "<div class='bottom'>&nbsp;&nbsp;<div class='controlgroup'><b>VARIABLES CLIMÁTICAS</b><br><select id='zoomFly'><option value='0'>Seleccione...</option><option value='2'>Días de calor extremo</option><option value='4'>Días de lluvia</option><option value='5'>Precipitación</option><option value='6'>Temperatura</option></select></div><br><b>MOSTRARME...</b><br><input type='radio' name='metric[]' id='annual' onclick='showSites();'checked/>Total o medio<input type='radio' name='metric[]' id='change' onclick='showSites();'> Combio<br><input type='radio' name='year[]' id='2050s' onclick='showSites();' checked/> 2050s <input type='radio' name='year[]' id='2080s' onclick='showSites();'> 2080s<br><input type='radio' name='rcp[]' id='rcp4p5' onclick='showSites();'> RCP 4.5 <input type='radio' name='rcp[]' id='rcp8p5'  onclick='showSites();' checked/> RCP 8.5<br><input type='radio' name='est[]' id='lowest' onclick='showSites();'> Estimado bajo <input type='radio' name='est[]' id='highest' onclick='showSites();' checked/> alto</div>";
	
	div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
	return div;
};

legend.addTo(map);


// drop-downs on map

var key= L.control({position: 'bottomleft'});
key.onAdd = function (map) {
  
	var div = L.DomUtil.create('div', 'info legend');
	div.innerHTML = div.innerHTML + "<div class='key'><img src='img/map_legend.png'></div>";
    div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
    return div;
};
//key.addTo(map);		
	
// countries and MPAs
cartodb.createLayer(map, cntry_mpa)
		.addTo(map)
        .on('done', function(layer) {
		layer.setZIndex(6);	
});


//$( "#zoomFly").val(6);
// Show sites at start		
//showSites();


$("#zoomFly").change(function(event){
	// grab numeric value of drop-down option
	var e = document.getElementById("zoomFly");
	var ddSitesVal = e.options[e.selectedIndex].value;
	showSites(ddSitesVal);
	addLegend($( "#zoomFly option:selected" ).text());
	//zoomFly($( "#zoomFly option:selected" ).text(), ddSitesVal);
	//$( "#zoomState").val(0);
});


var legend2;
legend2 = L.control({position: 'bottomleft'});	
var legend2Count = 0;
	
// ADD GRAPH IN TOP RIGHT	
function addLegend(name, queryScale){

	if (legend2Count > 0){map.removeControl(legend2);}
	
	legend2.onAdd = function (map) {

		var div = L.DomUtil.create('div', 'info legend');
		if (name == "Días de calor extremo"){
			div.innerHTML = div.innerHTML + "<div class='map-legend'><b>DÍAS DE CALOR EXTREMO</b> (# total)<br><img src='img/h_legend.png' width='95%' height='95%'></center><br><br><b>DÍAS DE CALOR EXTREMO</b> (# de cambio)<br><img src='img/h_legend.png' width='95%' height='95%'></center></div>";
		}
		else if (name == "Días de lluvia"){
			div.innerHTML = div.innerHTML + "<div class='map-legend'><b>DÍAS DE LLUVIA</b> (# total)<br><img src='img/rt_legend.png' width='95%' height='95%'></center><br><br><b>DÍAS DE LLUVIA</b> (# de cambio)<img src='img/rc_legend.png' width='95%' height='95%'></center></div>";
		}
		else if (name == "Precipitación"){
			div.innerHTML = div.innerHTML + "<div class='map-legend'><b>PRECIPITACIÓN</b> (media annual | mm)<br><img src='img/pm_legend.png' width='95%' height='95%'></center><br><br><b>PRECIPITACIÓN</b> (% de cambio)<img src='img/pc_legend.png' width='95%' height='95%'></center></div>";
		}
		else if (name == "Temperatura"){
			div.innerHTML = div.innerHTML + "<div class='map-legend'><b>TEMPERATURA</b> (media annual | °C)<br><img src='img/tm_legend.png' width='95%' height='95%'></center><br><br><b>TEMPERATURA</b></b> (cambio en °C)<br><img src='img/tc_legend.png' width='95%' height='95%'></center></div>";
		}
		/*	
		else if (name == "Sea Level Rise"){
			div.innerHTML = div.innerHTML + "<div class='map-legend'><br><br><b>SEA LEVEL RISE</b> (Change | cm)<br><img src='img/slr_legend.png' width='95%' height='95%'></center></div>";
		}
		else{
			div.innerHTML = div.innerHTML + "<div class='map-legend'><center><h5>"+name+"</h5></center><hr><div id='chart_div' style='width: 475px; height: 100px;'></div></div>";
		}
		*/
		//div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
		return div;
		legend2.setZIndex(2);
	};
	
	legend2.addTo(map);	
	legend2Count = legend2Count + 1;

}


// add basemap and overlays
var baseMaps = {
	"imágenes": ESRIImagery,
	"base gris claro": CartoLight,
	"océanos": ESRIOcean
};

// base maps
L.control.layers(baseMaps, null, {position: 'bottomright', collapsed: false}).addTo(map);
// scale
L.control.scale({ position: 'bottomright' }).addTo(map);
// zoom
L.control.zoom({position:'bottomright'}).addTo(map);
map.scrollWheelZoom.disable();


//////////////////////////////////////////

// initialize CARTO account
var sql = cartodb.SQL({ user: 'gverutes' });

//////////////////////////////////////////


//////////////////////////////////////////
// CLIMATE ///////////////////////////////
//////////////////////////////////////////

var startActions = 0;  
var countActions = 0;
var sublayersActions = [];

function showSites(){


	if (countActions > 0){
			sublayersActions[countActions-1].remove();
		}
		countActions = countActions + 1;	
	
	
	// find list of checked boxes
	//var checkedActionsList = [];	
    var chk = document.getElementsByName('metric[]')
    var chk = document.getElementsByName('year[]')
    var chk = document.getElementsByName('rcp[]')
    var chk = document.getElementsByName('est[]')
    //var len = chk.length

	// push text to list
	/*
    for(i=0;i<len;i++){
		if(chk[i].checked){
			checkedActionsList.push(chk[i].id);
        }
    }
	*/

	var MapQueryActions1 = "";
	var MapQueryActions2 = "SELECT * FROM land_grid_join";
	var CartoCSSActions1 = "";
	var CartoCSSActions2 = "";

	var button1 = document.getElementById("annual");
	var button2 = document.getElementById("change");

	var button3 = document.getElementById("2050s");
	var button4 = document.getElementById("2080s");

	var button5 = document.getElementById("rcp4p5");
	var button6 = document.getElementById("rcp8p5");

	var button7 = document.getElementById("lowest");
	var button8 = document.getElementById("highest");


	if ($( "#zoomFly option:selected" ).text() == 'Días de calor extremo'){		

		if (button1.checked){
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5045a_25 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 2;  line-opacity: 0;}#land_grid_join [ h_5045a_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5045a_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5045a_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5045a_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5045a_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5045a_75 >= 0";	
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5045a_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5045a_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5045a_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5045a_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5045a_75 <= 50] {polygon-fill: #ffffb2;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5085a_25 >= 0";	
						var CartoCSSActions1 = "#land_grid_join{ polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5085a_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5085a_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5085a_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5045a_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5085a_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5085a_75 >= 0";	
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5085a_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5085a_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5085a_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5085a_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5085a_75 <= 50] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8045a_25 >= 0";	
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8045a_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8045a_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8045a_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8045a_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8045a_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8045a_75 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8045a_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8045a_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8045a_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8045a_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8045a_75 <= 50] {polygon-fill: #ffffb2;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8085a_25 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8085a_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8085a_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8085a_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8045a_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8085a_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8085a_75 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8085a_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8085a_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8085a_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8085a_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8085a_75 <= 50] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			}

		//////////////////////////

		else{ // button 2
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5045c_25 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5045c_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5045c_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5045c_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5045c_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5045c_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5045c_75 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5045c_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5045c_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5045c_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5045c_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5045c_75 <= 50] {polygon-fill: #ffffb2;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5085c_25 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5085c_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5085c_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5085c_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5045c_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5085c_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_5085c_75 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_5085c_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_5085c_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_5085c_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_5085c_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_5085c_75 <= 50] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8045c_25 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8045c_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8045c_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8045c_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8045c_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8045c_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8045c_75 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8045c_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8045c_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8045c_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8045c_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8045c_75 <= 50] {polygon-fill: #ffffb2;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8085c_25 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8085c_25 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8085c_25 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8085c_25 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8045c_25 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8085c_25 <= 50] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where h_8085c_75 >= 0";
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ h_8085c_75 <= 250] {polygon-fill: #f03b20;}#land_grid_join [ h_8085c_75 <= 200] {polygon-fill: #fd8d3c;}#land_grid_join [ h_8085c_75 <= 150] {polygon-fill: #feb24c;}#land_grid_join [ h_8085c_75 <= 100] {polygon-fill: #fed976;}#land_grid_join [ h_8085c_75 <= 50] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			}
		

		cartodb.createLayer(map, land_grid)
		  .addTo(map)
		  .on('done', function(layer) {
			// change the query for the first layer
			var subLayerOptions = {
			  sql: MapQueryActions1,
			  cartocss: CartoCSSActions1,
			}
			var sublayer = layer.getSubLayer(0);
			layer.setZIndex(5);
			sublayer.set(subLayerOptions);
			sublayersActions.push(sublayer);
		  }).on('error', function() {
			// log the error
		  });
	}

	if ($( "#zoomFly option:selected" ).text() == 'Precipitación'){	

		if (button1.checked){
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)
						var MapQueryActions3 = "SELECT * FROM land_grid_join where p_5045a_25 >= 0";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 2;  line-opacity: 0;}#land_grid_join [ p_5045a_25 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5045a_25 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_5045a_25 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5045a_25 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_5045a_25 <= 3000] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)
						var MapQueryActions1 = "SELECT * FROM land_grid_join where p_5045a_75 >= 0";	
						var CartoCSSActions1 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5045a_75 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5045a_75 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_5045a_75 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5045a_75 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_5045a_75 <= 3000] {polygon-fill: #8c510a;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions3 = "SELECT * FROM land_grid_join where p_5085a_25 >= 0";	
						var CartoCSSActions3 = "#land_grid_join{ polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5085a_25 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5085a_25 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_5085a_25 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5045a_25 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_5085a_25 <= 3000] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join where p_5085a_75 >= 0";	
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5085a_75 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5085a_75 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_5085a_75 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5085a_75 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_5085a_75 <= 3000] {polygon-fill: #8c510a;}";
						} 
					}
				}

			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join where p_8045a_25 >= 0";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8045a_25 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8045a_25 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_8045a_25 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8045a_25 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_8045a_25 <= 3000] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions1 = "SELECT * FROM land_grid_join where p_8045a_75 >= 0";	
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8045a_75 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8045a_75 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_8045a_75 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8045a_75 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_8045a_75 <= 3000] {polygon-fill: #8c510a;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions3 = "SELECT * FROM land_grid_join where p_8085a_25 >= 0";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8085a_25 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8085a_25 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_8085a_25 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8045a_25 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_8085a_25 <= 3000] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join where p_8085a_75 >= 0";	
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8085a_75 <= 17000] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8085a_75 <= 13000] {polygon-fill: #c7eae5;}#land_grid_join [ p_8085a_75 <= 10000] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8085a_75 <= 7000] {polygon-fill: #d8b365;}#land_grid_join [ p_8085a_75 <= 3000] {polygon-fill: #8c510a;}";
						} 
					}
				}
			}

		//////////////////////////

		else{ // button 2
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5045c_25 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5045c_25 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_5045c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5045c_25 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_5045c_25 <= -20] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5045c_75 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5045c_75 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_5045c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5045c_75 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_5045c_75 <= -20] {polygon-fill: #8c510a;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5085c_25 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5085c_25 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_5085c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5045c_25 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_5085c_25 <= -20] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_5085c_75 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_5085c_75 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_5085c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_5085c_75 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_5085c_75 <= -20] {polygon-fill: #8c510a;}";
						} 
					}
				}
			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8045c_25 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8045c_25 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_8045c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8045c_25 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_8045c_25 <= -20] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8045c_75 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8045c_75 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_8045c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8045c_75 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_8045c_75 <= -20] {polygon-fill: #8c510a;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8085c_25 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8085c_25 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_8085c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8045c_25 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_8085c_25 <= -20] {polygon-fill: #8c510a;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions3 = "SELECT * FROM land_grid_join";
						var CartoCSSActions3 = "#land_grid_join{  polygon-fill: #01665e;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ p_8085c_75 <= 20] {polygon-fill: #5ab4ac;}#land_grid_join [ p_8085c_75 <= 10] {polygon-fill: #c7eae5;}#land_grid_join [ p_8085c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ p_8085c_75 <= -10] {polygon-fill: #d8b365;}#land_grid_join [ p_8085c_75 <= -20] {polygon-fill: #8c510a;}";
						} 
					}
				}
			}

		cartodb.createLayer(map, land_grid3)
		  .addTo(map)
		  .on('done', function(layer) {
			// change the query for the first layer
			var subLayerOptions = {
			  sql: MapQueryActions3,
			  cartocss: CartoCSSActions3,
			}
			var sublayer = layer.getSubLayer(0);
			layer.setZIndex(5);
			sublayer.set(subLayerOptions);
			sublayersActions.push(sublayer);
		  }).on('error', function() {
			// log the error
		  });
	}

	if ($( "#zoomFly option:selected" ).text() == 'Temperatura'){	

		if (button1.checked){
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5045a_25 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5045a_25 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_5045a_25 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5045a_25 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_5045a_25 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_5045a_25 <= 5] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5045a_75 >= 0";	
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5045a_75 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_5045a_75 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5045a_75 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_5045a_75 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_5045a_75 <= 5] {polygon-fill: #ffffb2;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5085a_25 >= 0";	
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5085a_25 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_5085a_25 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5085a_25 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_5045a_25 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_5045a_25 <= 5] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5085a_75 >= 0";	
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5085a_75 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_5085a_75 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5085a_75 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_5085a_75 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_5085a_75 <= 5] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8045a_25 >= 0";	
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8045a_25 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_8045a_25 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8045a_25 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_8045a_25 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_8045a_25 <= 5] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8045a_75 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8045a_75 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_8045a_75 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8045a_75 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_8045a_75 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_8045a_75 <= 5] {polygon-fill: #ffffb2;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8085a_25 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8085a_25 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_8085a_25 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8085a_25 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_8045a_25 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_8045a_25 <= 5] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8085a_75 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8085a_75 <= 25] {polygon-fill: #f03b20;}#land_grid_join [ t_8085a_75 <= 20] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8085a_75 <= 15] {polygon-fill: #feb24c;}#land_grid_join [ t_8085a_75 <= 10] {polygon-fill: #fed976;}#land_grid_join [ t_8085a_75 <= 5] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			}

		//////////////////////////

		else{ // button 2
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5045c_25 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5045c_25 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_5045c_25 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5045c_25 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_5045c_25 <= 1.25] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5045c_75 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5045c_75 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_5045c_75 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5045c_75 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_5045c_75 <= 1.25] {polygon-fill: #ffffb2;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5085c_25 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5085c_25 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_5085c_25 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5085c_25 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_5045c_25 <= 1.25] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_5085c_75 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_5085c_75 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_5085c_75 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_5085c_75 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_5085c_75 <= 1.25] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			else{ // button 4 (2.7580s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8045c_25 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8045c_25 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_8045c_25 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8045c_25 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_8045c_25 <= 1.25] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8045c_75 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8045c_75 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_8045c_75 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8045c_75 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_8045c_75 <= 1.25] {polygon-fill: #ffffb2;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8085c_25 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8085c_25 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_8085c_25 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8085c_25 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_8045c_25 <= 1.25] {polygon-fill: #ffffb2;}";
						}
					else{ // button 8 (highest)	
						var MapQueryActions4 = "SELECT * FROM land_grid_join where t_8085c_75 >= 0";
						var CartoCSSActions4 = "#land_grid_join{  polygon-fill: #bd0026;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ t_8085c_75 <= 2.75] {polygon-fill: #f03b20;}#land_grid_join [ t_8085c_75 <= 2.25] {polygon-fill: #fd8d3c;}#land_grid_join [ t_8085c_75 <= 1.75] {polygon-fill: #f6e8c3;}#land_grid_join [ t_8085c_75 <= 1.25] {polygon-fill: #ffffb2;}";
						} 
					}
				}
			}

		cartodb.createLayer(map, land_grid4)
		  .addTo(map)
		  .on('done', function(layer) {
			// change the query for the first layer
			var subLayerOptions = {
			  sql: MapQueryActions4,
			  cartocss: CartoCSSActions4,
			}
			var sublayer = layer.getSubLayer(0);
			layer.setZIndex(5);
			sublayer.set(subLayerOptions);
			sublayersActions.push(sublayer);
		  }).on('error', function() {
			// log the error
		  });
	}


	if ($( "#zoomFly option:selected" ).text() == 'Días de lluvia'){	

		if (button1.checked){
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5045a_25 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_5045a_25 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_5045a_25 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_5045a_25 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_5045a_25 <= 50] {polygon-fill: #a8ddb5;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5045a_75 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_5045a_75 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_5045a_75 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_5045a_75 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_5045a_75 <= 50] {polygon-fill: #a8ddb5;}";
						}
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5085a_25 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_5085a_25 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_5085a_25 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_5045a_25 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_5085a_25 <= 50] {polygon-fill: #a8ddb5;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5085a_75 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_5085a_75 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_5085a_75 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_5085a_75 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_5085a_75 <= 50] {polygon-fill: #a8ddb5;}";
						} 
					}
				}
			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8045a_25 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_8045a_25 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_8045a_25 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_8045a_25 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_8045a_25 <= 50] {polygon-fill: #a8ddb5;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8045a_75 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_8045a_75 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_8045a_75 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_8045a_75 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_8045a_75 <= 50] {polygon-fill: #a8ddb5;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8085a_25 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_8085a_25 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_8085a_25 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_8045a_25 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_8085a_25 <= 50] {polygon-fill: #a8ddb5;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #084081;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8085a_75 <= 250] {polygon-fill: #0868ac;}#land_grid_join [ r_8085a_75 <= 200] {polygon-fill: #2b8cbe;}#land_grid_join [ r_8085a_75 <= 150] {polygon-fill: #4eb3d3;}#land_grid_join [ r_8085a_75 <= 100] {polygon-fill: #7bccc4;}#land_grid_join [ r_8085a_75 <= 50] {polygon-fill: #a8ddb5;}";
						} 
					}
				}
			}
		

		//////////////////////////

		else{ // button 2
			if (button3.checked){ // button 3 (2050s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5045c_25 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_5045c_25 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_5045c_25 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_5045c_25 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_5045c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_5045c_25 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_5045c_25 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_5045c_25 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_5045c_25 <= -20] {polygon-fill: #543005;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5045c_75 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_5045c_75 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_5045c_75 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_5045c_75 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_5045c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_5045c_75 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_5045c_75 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_5045c_75 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_5045c_75 <= -20] {polygon-fill: #543005;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){ // button 7 (lowest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5085c_25 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_5085c_25 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_5085c_25 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_5085c_25 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_5085c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_5085c_25 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_5085c_25 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_5085c_25 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_5085c_25 <= -20] {polygon-fill: #543005;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_5085c_75 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_5085c_75 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_5085c_75 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_5085c_75 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_5085c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_5085c_75 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_5085c_75 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_5085c_75 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_5085c_75 <= -20] {polygon-fill: #543005;}";
						} 
					}
				}
			else{ // button 4 (2080s)
				if (button5.checked){ // button 5 (rcp4.5)
					if (button7.checked){ // button 7 (lowest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8045c_25 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_8045c_25 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_8045c_25 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_8045c_25 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_8045c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_8045c_25 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_8045c_25 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_8045c_25 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_8045c_25 <= -20] {polygon-fill: #543005;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8045c_75 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_8045c_75 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_8045c_75 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_8045c_75 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_8045c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_8045c_75 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_8045c_75 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_8045c_75 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_8045c_75 <= -20] {polygon-fill: #543005;}";
						} 
					}
				else{ // button 6 (rcp8.5)
					if (button7.checked){ // button 7 (lowest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8085c_25 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_8085c_25 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_8085c_25 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_8085c_25 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_8085c_25 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_8085c_25 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_8085c_25 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_8085c_25 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_8085c_25 <= -20] {polygon-fill: #543005;}";
						}
					else{ // button 8 (highest)	
						var CartoCSSActions2 = "#land_grid_join{  polygon-fill: #003c30;  polygon-opacity: 0.8;  line-color: #FFF;  line-width: 0;  line-opacity: 0;}#land_grid_join [ r_8085c_75 <= 20] {polygon-fill: #01665e;}#land_grid_join [ r_8085c_75 <= 15] {polygon-fill: #35978f;}#land_grid_join [ r_8085c_75 <= 10] {polygon-fill: #80cdc1;}#land_grid_join [ r_8085c_75 <= 5] {polygon-fill: #c7eae5;}#land_grid_join [ r_8085c_75 <= 0] {polygon-fill: #f6e8c3;}#land_grid_join [ r_8085c_75 <= -5] {polygon-fill: #dfc27d;}#land_grid_join [ r_8085c_75 <= -10] {polygon-fill: #bf812d;}#land_grid_join [ r_8085c_75 <= -15] {polygon-fill: #8c510a;}#land_grid_join [ r_8085c_75 <= -20] {polygon-fill: #543005;}";
						} 
					}
				}
			}
		
					
		cartodb.createLayer(map, land_grid2)
		  .addTo(map)
		  .on('done', function(layer) {
			// change the query for the first layer
			var subLayerOptions = {
			  sql: MapQueryActions2,
			  cartocss: CartoCSSActions2,
			}
			var sublayer = layer.getSubLayer(0);
			layer.setZIndex(5);
			sublayer.set(subLayerOptions);
			sublayersActions.push(sublayer);
		  }).on('error', function() {
			// log the error
		  });

	}
}

</script>	
</div>
</body>
</html>